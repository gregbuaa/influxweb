{% load static %}
<DOCTYPE HTML>
<!--_meta 作为公共模版分离出去-->

<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="favicon.ico" >
<link rel="Shortcut Icon" href="favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="/static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="/static/lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="/static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/style.css" />

<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->

<title>数据库管理系统</title>
</head>
<body>
<!--_header 作为公共模版分离出去-->
<header class="navbar-wrapper">
	<div class="navbar navbar-fixed-top">
		<div class="container-fluid cl"> 
			<span class="logo navbar-slogan f-l mr-10 hidden-xs">数据库管理系统</span> 
			<a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
			<nav class="nav navbar-nav">
				<ul class="cl">
					<li class="dropDown dropDown_hover"><a href="javascript:;" class="dropDown_A"><i class="Hui-iconfont">&#xe600;</i> 新增 <i class="Hui-iconfont">&#xe6d5;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" onclick="article_add('添加资讯','article-add.html')"><i class="Hui-iconfont">&#xe616;</i> 本地主机</a></li>
							<li><a href="javascript:;" onclick="picture_add('添加资讯','picture-add.html')"><i class="Hui-iconfont">&#xe613;</i> 外围主机</a></li>
							<li><a href="javascript:;" onclick="product_add('添加资讯','product-add.html')"><i class="Hui-iconfont">&#xe620;</i> 数据记录</a></li>
							<li><a href="javascript:;" onclick="member_add('添加用户','member-add.html','','510')"><i class="Hui-iconfont">&#xe60d;</i> 用户</a></li>
				</ul>
			</li>
		</ul>
	</nav>
			<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
				<ul class="cl">
					{% if request.session.is_login %}
					<li>超级管理员</li>
					<li class="dropDown dropDown_hover"> <a href="#" class="dropDown_A">{{ request.session.user_name }} <i class="Hui-iconfont">&#xe6d5;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" onClick="myselfinfo()">个人信息</a></li>
							<li><a href="{% url 'logout' %}">切换账户</a></li>
							<li><a href="{% url 'logout' %}">退出</a></li>
						{% else %}
						<li><a href="{% url 'login' %}">登录</a></li>
					{% endif %}
				</ul>
			</li>
					<li id="Hui-msg"> <a href="#" title="消息"><span class="badge badge-danger">1</span><i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i></a> </li>
					<li id="Hui-skin" class="dropDown right dropDown_hover"> <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
							<li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
							<li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
							<li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
							<li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
							<li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
				</ul>
			</li>
		</ul>
	</nav>
</div>
</div>
<script src="{% static 'h-ui/js/vue.js' %}"></script>

<style>
*{
	box-sizing: border;
	margin: 0;padding: 0;
}
*:before,*:after{
	box-sizing: border-box;
}
ul,
li {
	list-style: none;
}

.l_tree_container {
	width: 100%;
	height: 100%;
	box-shadow: 0 0 3px #ccc;
	margin: 10px;
	position: relative;
}

.l_tree {
	width: calc(100% - 44px);
	height: 100%;
	padding-left: 42px;
}
.l_tree_branch {
	width: 100%;
	height: 100%;
	display: block;
	padding: 13px;
	position: relative;
}

.l_tree_branch .l_tree_children_btn {
	width: 19px;
	height: 19px;
	background-color: #23b1f0;
	font-size: 12px;
	text-align: center;
	color: #ffffff;
	outline: none;
	border: 0;
	cursor: pointer;
}

ul.l_tree:before {
	content: '';
	border-left: 1px dashed #999999;
	height: calc(100%);
	position: absolute;
	left: 10px;
	top: 0px;
}

.l_tree .l_tree_branch:last-child::before {
	content: '';
	width: 3px;
	height: calc(100% - 24px);
	display: block;
	background-color: #ffffff;
	position: absolute;
	bottom: 0;
	left: -34px;
}

.l_tree,
.l_tree_branch {
	position: relative;
}

.l_tree_branch::after {
	content: '';
	width: 40px;
	height: 0;
	border-bottom: 1px dashed #000;
	position: absolute;
	right: calc(100% - 9px);
	top: 22px;
}

.l_tree_container>.l_tree::before,
.l_tree_container>.l_tree>.l_tree_branch::after {
	display: none;
}
</style>

</header>

<aside class="Hui-aside">
<table>
  <tr>
    <td height="50%">
	<div id="demo">
	<div class="l_tree_container">
		<ew1-tree :model="testdata"></ew1-tree>
	</div>
	</div>

	<script>
		// 树组件

	
		
		Vue.component('ew1-tree', {
			template: `
			<ul class="l_tree">
				<li class="l_tree_branch" v-for="item in model" :key="item.id">
					<div class="l_tree_click">
						<button type="button" class="l_tree_children_btn" v-if="item.children"  @click="toggle(item)">{% verbatim myblock %}{{ !item.show ? '-' : '+' }}{% endverbatim myblock %}</button>
						<span class="l_folder"  @click="achievesite(item)"><strong>{% verbatim myblock %}{{ item.chinese_name }}{% endverbatim myblock %}</strong></span>
					</div>
					<ew1-tree v-show="!item.show" v-if="item.children" :model="item.children"></ew1-tree>
				</li>
			</ul>`,
			props: {
				model: {}
			},
			methods: {
				toggle: function (item) {
					var idx = this.model.indexOf(item)
					Vue.set(this.model[idx], 'show', !item.show)
				},
				achievesite: function(item) {
					if(!item.database){
						return;
					}
					// console.log(item.name)
					// console.log(item.database)
					// console.log(item.site_no)
					data = {'site_no':item.site_no, "database":item.database, 'table_name':item.name,'table_chinese_name':item.chinese_name}
					$.ajax({
						url:"{% url 'load_site_table' %}",
						type:"GET",
						data:data,
						success:function(result) {
							// console.log(result)
							show_influx_table(result)
						}
					})
				}
			}
		});
		
	</script>
	  </td>
  </tr>
	
  <tr>
    <td height="50%">
	<div id="demo2">
	<div class="l_tree_container">
		<ew2-tree :model="testdata"></ew2-tree>
	</div>
	</div>

	<script>
		// 树组件
		
		Vue.component('ew2-tree', {
			template: `
			<ul class="l_tree">
				<li class="l_tree_branch" v-for="item in model" :key="item.id">
					<div class="l_tree_click">
						<button type="button" class="l_tree_children_btn" v-if="item.children"  @click="toggle(item)">{% verbatim myblock %}{{ !item.show ? '-' : '+' }}{% endverbatim myblock %}</button>
						<span class="l_folder" @click="achievesite(item)"><strong>{% verbatim myblock %}{{ item.chinese_name }}{% endverbatim myblock %}</strong></span>
					</div>
					<ew2-tree v-show="!item.show" v-if="item.children" :model="item.children"></ew2-tree>
				</li>
			</ul>`,
			props: {
				model: {}
			},
			methods: {
				toggle: function (item) {
					var idx = this.model.indexOf(item)
					Vue.set(this.model[idx], 'show', !item.show)
				},
				achievesite: function(item) {
					if(!item.name){
						return;
					}
					// console.log(item.name)
					data = {'table':item.name,'table_chinese_name':item.chinese_name}
					$.ajax({
						url:"{% url 'load_config_table' %}",
						type:"GET",
						data:data,
						success:function(result) {
							// console.log(result)
							show_config_table(result)
						}
					})
				}
			}
		});
	</script>
	  </td>
  </tr>
</table>

</aside>
		
	
<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>

<section class="Hui-article-box">
	<nav class="breadcrumb">
		<span class="c-666">数据展示</span> 
		<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
	<div class="Hui-article">
		<article class="cl pd-20" style="width: 1200px">
			<table class="table table-border table-bordered table-bg" id="show_data" />
	

</article>

</div>
</section>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="{% static 'lib/jquery/1.9.1/jquery.min.js' %}"></script> 
<script type="text/javascript" src="{% static 'lib/layer/2.4/layer.js' %}"></script>
<script type="text/javascript" src="{% static 'h-ui/js/H-ui.js' %}"></script> 
<script type="text/javascript" src="{% static 'h-ui.admin/js/H-ui.admin.page.js' %}"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript">
	site_tables = []
		$(document).ready(function(){ 
			data = {}
			$.ajax({
            url:"{% url 'load_tables_info' %}",
            type:"GET",
            data:data,
			success:function (result) { // result is String
				console.log(result)
				site_tables = result['site_tables']
				config_tables = result['config_tables']

				// new_site_tables = []
				// for 
				new Vue({
					el: "#demo",
					data() {
						return {
							testdata: [{chinese_name: "influx数据库",
							children:site_tables
							}]
						}
					}
				})
				new Vue({
					el:"#demo2",
					data() {
						return {
							testdata:[{chinese_name:"MySQL配置数据库",
							children: config_tables
							}]
						}
					}
				})
			}
		});
	})

	// 点击表名之后，返回表的部分数据，用于表格展示
	function show_influx_table(result) {
		// console.log(result)
		show_config_table(result)
	}

	function show_config_table(result) {
		// console.log(result)
		table_name = result['table_name']
		table_data = result['table_data']
		chinese_title = result['chinese_title']

		var attribute_list = []
		var realtime_list = []
		
		str = "<thead><tr><th colspan='11' scope='col'>"+table_name+"</th></tr><tr class='text-c'>"
		$.each(chinese_title, function(index, item){
			// console.log(index,item)
			
			attribute_list.push(item["domain_name"])
			// console.log(item['isrealtime'])
			if(item['isrealtime']==1){
				str+= "<th><font color='red'>"+item['domain_chinese_name']+"</font></th>"
				realtime_list.push(item['domain_name'])
			}else{
				str+="<th>"+item['domain_chinese_name']+"</th>"
			}
		});
		str+= "</tr></thead><tbody>"
		
		// console.log(attribute_list)

		$.each(table_data, function(index,item){
			str += "<tr class='text-c'>"
			for(var i = 0; i < attribute_list.length; i++){
				if($.inArray(attribute_list[i], realtime_list) >=0){
					str+= "<td><strong><font color='red' size='2'>"+item[attribute_list[i]]+"</font></strong></td>"
				}else{
					str+= "<td>"+item[attribute_list[i]]+"</td>"
				}
				
			}
			str+="</tr>"
		});

		str+= "</tbody>"
		$('#show_data').html(str)
	}



</script>
<!--/请在上方写此页面业务相关的脚本-->

</body>
</html>